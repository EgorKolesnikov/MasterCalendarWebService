## Подготовка

Напомню, что я использую cppCMS, который способен работать и напрямую с http протоколом и с fastcgi (поставив перед ним nginx).
Приведу результаты нагрузочного тестирования обоих методов.

Конфиги nginx, yandex-tank и сервера доступны в папке config/.
В каталоге run/ содержатся скрипты для запуска сервера, танка и nginx.


## nginx + fastcgi

Результат нагрузочного тестирования доступен здесь (5000 - 15000, 2m): https://overload.yandex.net/128227

Примерно на 10000 тысячах возникают проблемы. Об этом нам говорят и графики Quantiles, Response time distribution,
а также HTTP codes, где мы видим появление http_0. 

Судя по графикам квантили ещё долго поступают ответы на запросы после завершения стрельбищ.
На графиках мониторинга видим, что с памятью всё стабильно, а вот в лимит CPU начинаем упираться.

На 10000 действительно картина не очень хорошая: const(10000, 5m): https://overload.yandex.net/128229
Квантиль 95% в целом хорошая, но есть запросы и вовсе без ответа, Response time distribution на пределе.

При рассмотрении роста 8000-9000 видим, что даже здесь долго справляться с нагрузкой мы не можем: https://overload.yandex.net/128231.
Но 8000 должны уметь держать. И действительно, можем, достаточно уверенно: https://overload.yandex.net/128233

Вывод: в случае nginx + fastcgi укладываемся в 8000.


## http (only cppCMS)

Проведём те же эксперименты что и ранее. Сначала будем расти с 5000 до 15000 за 2 минуты. Результат: https://overload.yandex.net/128221

До 12000 всё хорошо, на 13000 мы видим уже http_0 code и в мониторинге видим, что снова упираемся в CPU.
Видно, что задолго после окончания стрельбищ продолжают приходить ответы на запросы

Посмотрим, можем ли держать 12000-13000 в течении долгого периода (10m): https://overload.yandex.net/128224

В самом начале квантиль 95% была в ~1s, но после упала и стала 2-10 ms в среднем (закрыл браузер с youtube вкладкой).
После этого держимся стаблильно (и время ответа и CPU и memory).
Можем утверждать, что наш сервис с использованием http (only cppCMS) способен уверенно выдерживать 12500 rps.

## Выводы
* nginx + fastcgi: 8500
* http (only cppCMS): 12500 rps

В обоих случаях упираемся в CPU.
